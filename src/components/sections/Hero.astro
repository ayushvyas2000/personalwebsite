---
import Button from '../ui/Button.astro';
import Icon from '../ui/Icon.astro';
import { personalInfo, summary, socialLinks } from '../../data/portfolio';
---

<section id="home" class="relative min-h-screen flex items-center overflow-hidden grid-bg pt-24 pb-16">
  <!-- Particle Canvas Background -->
  <canvas id="particles-canvas"></canvas>

  <!-- Animated background orbs -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="bg-orb bg-orb-1 top-1/4 left-1/6 animate-float-rotate"></div>
    <div class="bg-orb bg-orb-2 bottom-1/4 right-1/6 animate-float-rotate" style="animation-delay: 2s;"></div>
    <div class="bg-orb bg-orb-3 top-2/3 left-1/2 animate-float-rotate" style="animation-delay: 4s;"></div>
  </div>

  <!-- Morphing gradient overlay -->
  <div class="absolute inset-0 morph-gradient pointer-events-none"></div>

  <div class="container mx-auto px-4 md:px-6 lg:px-8 max-w-6xl relative z-10">
    <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-center">
      
      <!-- Left: Text Content -->
      <div class="order-2 lg:order-1 text-center lg:text-left">
        <!-- Greeting -->
        <p class="text-primary font-mono text-sm md:text-base mb-3 animate-fade-in-up opacity-0">
          <span class="typing-cursor" id="greeting-text"></span>
        </p>

        <!-- Name -->
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-3 animate-fade-in-up opacity-0 stagger-1">
          <span class="text-text">{personalInfo.name}</span>
        </h1>

        <!-- Title with animated gradient -->
        <h2 class="text-xl md:text-2xl lg:text-3xl font-semibold mb-5 animate-fade-in-up opacity-0 stagger-2">
          <span class="gradient-text-shift">{personalInfo.title}</span>
        </h2>

        <!-- Headline -->
        <p class="text-base md:text-lg text-text-muted mb-8 max-w-lg mx-auto lg:mx-0 animate-slide-up-blur opacity-0 stagger-3">
          {summary.headline}
        </p>

        <!-- CTA Buttons -->
        <div class="flex flex-col sm:flex-row items-center lg:items-start justify-center lg:justify-start gap-4 mb-8 animate-flip-in-x opacity-0 stagger-4">
          <Button variant="primary" size="md" href="#projects">
            View My Work
            <Icon icon="arrow-right" size={18} />
          </Button>
          <Button variant="outline" size="md" href="/resume.pdf" target="_blank" rel="noopener noreferrer">
            <Icon icon="download" size={18} />
            Resume
          </Button>
        </div>

        <!-- Social Links with magnetic effect -->
        <div class="flex items-center justify-center lg:justify-start gap-3 animate-fade-in-up opacity-0 stagger-5">
          {socialLinks.map((link) => (
            <a 
              href={link.url}
              target="_blank"
              rel="noopener noreferrer"
              class="magnetic p-2.5 rounded-lg border border-border text-text-muted hover:text-primary hover:border-primary hover:shadow-lg hover:shadow-primary/20 transition-all duration-300 hover:-translate-y-1"
              aria-label={link.name}
            >
              <Icon icon={link.icon as 'github' | 'linkedin' | 'email'} size={20} />
            </a>
          ))}
        </div>
      </div>

      <!-- Right: Avatar with 3D orbit -->
      <div class="order-1 lg:order-2 flex justify-center lg:justify-end animate-scale-in-3d opacity-0">
        <div class="relative" id="hero-avatar">
          <!-- Main avatar with 3D tilt -->
          <div class="w-48 h-48 md:w-64 md:h-64 lg:w-80 lg:h-80 rounded-full overflow-hidden border-2 border-primary/30 shadow-2xl shadow-primary/20 card-3d">
            <img 
              src="/avatar.png" 
              alt={personalInfo.name}
              class="w-full h-full object-cover"
            />
          </div>
          
          <!-- Orbiting decorative ring -->
          <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="w-[110%] h-[110%] rounded-full border border-primary/20 animate-pulse" style="animation-duration: 3s;"></div>
          </div>
          <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="w-[125%] h-[125%] rounded-full border border-secondary/10" style="animation: orbit 20s linear infinite reverse;"></div>
          </div>
          
          <!-- Orbiting dots -->
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
            <div class="animate-orbit">
              <div class="w-3 h-3 bg-primary rounded-full shadow-lg shadow-primary/50"></div>
            </div>
          </div>
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
            <div class="animate-orbit" style="animation-delay: -5s; animation-duration: 20s;">
              <div class="w-2 h-2 bg-secondary rounded-full shadow-lg shadow-secondary/50"></div>
            </div>
          </div>
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
            <div class="animate-orbit" style="animation-delay: -10s; animation-duration: 25s;">
              <div class="w-2 h-2 bg-accent rounded-full shadow-lg shadow-accent/50"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="absolute bottom-6 left-1/2 -translate-x-1/2 animate-bounce hidden md:block">
    <div class="w-5 h-8 border-2 border-text-muted/50 rounded-full p-1">
      <div class="w-1 h-2 bg-primary rounded-full mx-auto animate-pulse"></div>
    </div>
  </div>
</section>

<script>
  // ==========================================
  // PARTICLE NETWORK BACKGROUND
  // ==========================================
  const canvas = document.getElementById('particles-canvas') as HTMLCanvasElement;
  if (canvas) {
    const ctx = canvas.getContext('2d');
    let particles: { x: number; y: number; vx: number; vy: number; size: number; opacity: number }[] = [];
    let animationId: number;
    let mouseX = 0;
    let mouseY = 0;

    function resizeCanvas() {
      const section = canvas.parentElement;
      if (section) {
        canvas.width = section.offsetWidth;
        canvas.height = section.offsetHeight;
      }
    }

    function createParticles() {
      const count = Math.min(80, Math.floor((canvas.width * canvas.height) / 15000));
      particles = [];
      for (let i = 0; i < count; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          vx: (Math.random() - 0.5) * 0.5,
          vy: (Math.random() - 0.5) * 0.5,
          size: Math.random() * 2 + 0.5,
          opacity: Math.random() * 0.5 + 0.1
        });
      }
    }

    function drawParticles() {
      if (!ctx) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      particles.forEach((p, i) => {
        // Move particles
        p.x += p.vx;
        p.y += p.vy;

        // Mouse repulsion
        const dx = p.x - mouseX;
        const dy = p.y - mouseY;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 150) {
          const force = (150 - dist) / 150;
          p.vx += (dx / dist) * force * 0.02;
          p.vy += (dy / dist) * force * 0.02;
        }

        // Dampen velocity
        p.vx *= 0.99;
        p.vy *= 0.99;

        // Wrap around edges
        if (p.x < 0) p.x = canvas.width;
        if (p.x > canvas.width) p.x = 0;
        if (p.y < 0) p.y = canvas.height;
        if (p.y > canvas.height) p.y = 0;

        // Draw particle
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(0, 212, 255, ${p.opacity})`;
        ctx.fill();

        // Draw connections
        for (let j = i + 1; j < particles.length; j++) {
          const p2 = particles[j];
          const dx2 = p.x - p2.x;
          const dy2 = p.y - p2.y;
          const dist2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
          if (dist2 < 120) {
            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.strokeStyle = `rgba(0, 212, 255, ${0.08 * (1 - dist2 / 120)})`;
            ctx.lineWidth = 0.5;
            ctx.stroke();
          }
        }
      });

      animationId = requestAnimationFrame(drawParticles);
    }

    // Track mouse position relative to canvas
    const heroSection = canvas.parentElement;
    heroSection?.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      mouseX = e.clientX - rect.left;
      mouseY = e.clientY - rect.top;
    });

    resizeCanvas();
    createParticles();
    drawParticles();

    window.addEventListener('resize', () => {
      resizeCanvas();
      createParticles();
    });

    // Cleanup on navigation
    document.addEventListener('astro:before-swap', () => {
      cancelAnimationFrame(animationId);
    });
  }

  // ==========================================
  // TYPING EFFECT
  // ==========================================
  function initTypingEffect() {
    const greetingEl = document.getElementById('greeting-text');
    if (greetingEl) {
      const text = "Hello, I'm";
      let i = 0;
      function typeText() {
        if (i < text.length) {
          greetingEl!.textContent = text.substring(0, i + 1);
          i++;
          setTimeout(typeText, 80 + Math.random() * 40);
        }
      }
      setTimeout(typeText, 500);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTypingEffect);
  } else {
    initTypingEffect();
  }

  // ==========================================
  // 3D TILT ON AVATAR
  // ==========================================
  const avatar = document.getElementById('hero-avatar');
  if (avatar) {
    const card = avatar.querySelector('.card-3d') as HTMLElement;
    avatar.addEventListener('mousemove', (e) => {
      const rect = avatar.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = (y - centerY) / centerY * -10;
      const rotateY = (x - centerX) / centerX * 10;
      if (card) {
        card.style.transform = `perspective(800px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      }
    });
    avatar.addEventListener('mouseleave', () => {
      if (card) {
        card.style.transform = 'perspective(800px) rotateX(0deg) rotateY(0deg)';
      }
    });
  }
</script>
